<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="SubBoard">
    <!-- 取别名 -->
    <typeAlias alias="SubBoard" type="com.raycloud.pojo.SubBoard"/>
    <!-- 定制返回的map -->
    <resultMap id="SubBoardMap" class="SubBoard" >
        <result property="boardId" column="board_id"/>
        <result property="content" column="content"/>
        <result property="articleId" column="article_id"/>
        <result property="headPhotoUrl" column="head_photo_url"/>
        <result property="username" column="username"/>
        <result property="created" column="created"/>
        <result property="modified" column="modified"/>
        <result property="status" column="status"/>
    </resultMap>

    <sql id="fieldsAs">
        board_id as boardId,
        content,
        article_id as articleId,
        head_photo_url as headPhotoUrl,
        username,
        created,
        modified,
        status
    </sql>
    <sql id="selector">
        select
        <dynamic>
            <isNotEmpty property="fields">
                $fields$
            </isNotEmpty>
            <isEmpty property="fields">
               <include refid="fieldsAs"></include>
            </isEmpty>
        </dynamic>
        from sub_board_$splitTableName$
    </sql>
    <sql id="where">
        <dynamic prepend="where">
            <isNotNull property="boardId" prepend="and">
                board_id = #boardId#
            </isNotNull>
            <isNotNull property="articleId" prepend="and">
                article_id = #articleId#
            </isNotNull>
            <isNotNull property="username" prepend="and">
                username = #username#
            </isNotNull>
            <isNotNull property="splitTableName" prepend="and">
                split = $splitTableName$
            </isNotNull>
            <isNotNull property="content" prepend="and">
                content = #content#
            </isNotNull>
            <isNotNull property="headPhotoUrl" prepend="and">
                head_photo_url = #headPhotoUrl#
            </isNotNull>
            <isNotNull property="status" prepend="and">
                status = #status#
            </isNotNull>
        </dynamic>
    </sql>

    <!-- 切记，order 后面不能用##,而应该用$$ -->
    <sql id="order">
        <dynamic prepend="order by">
            <isNotEmpty property="orderFields">
                <iterate property="orderFields" conjunction="," open="" close="">
                    $orderFields[].fieldName$ $orderFields[].order$
                </iterate>
            </isNotEmpty>
        </dynamic>
    </sql>

    <sql id="limit">
        <dynamic prepend="limit">
            <isNotEmpty property="startRow">
                $startRow$,$pageSize$
            </isNotEmpty>
        </dynamic>
    </sql>



    <!-- 获取某篇文章下的所有子评论 -->
    <select id="getList" parameterClass="SubBoard"  resultClass="SubBoard">
        <include refid="selector"></include>
        <include refid="where"></include>
        <include refid="order"></include>
        <include refid="limit"></include>
    </select>

    <select id="getCount" parameterClass="SubBoard" resultClass="int">
        select count(1) from sub_board_$splitTableName$
        <include refid="where"></include>
    </select>


    <insert id="insert" parameterClass="SubBoard" >
        insert into sub_board_$splitTableName$
        (board_id,split,content,article_id,head_photo_url,username,created,status)
        values(
        #boardId#,
        #splitTableName#,
        #content#,
        #articleId#,
        #headPhotoUrl#,
        #username#,
        #created#,
        #status#
        )

    </insert>








</sqlMap>
